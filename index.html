<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI Marketing Toolkit ‚Äì MikeGuides</title>
  <meta name="description" content="Interactive toolkit to create ads, emails, social posts, landing pages, and image prompts with AI." />
  <meta name="theme-color" content="#2563eb">

  <link rel="manifest" href="manifest.webmanifest">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Poppins:wght@600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --primary:#2563eb; --primary-700:#1e40af; --accent:#22c55e;
      --bg:#f9fafb; --card:#ffffff; --text:#111827; --muted:#6b7280; --border:#e5e7eb;
      --shadow:0 12px 36px rgba(17,24,39,.08); --radius:18px;
    }
    @media (prefers-color-scheme: dark){
      :root{
        --bg:#0b1220; --card:#101726; --text:#e5e7eb; --muted:#9aa3b2; --border:#1f2937;
        --shadow:0 8px 28px rgba(0,0,0,.45);
      }
      .out{border-color:#243044}
      .tab-btn{background:#0f172a;border-color:#1f2937;color:#cbd5e1}
      .tab-btn.active{background:#1d4ed8;border-color:#1d4ed8;color:#fff}
      .hero{background:linear-gradient(135deg,#0f172a 0%,#0b1220 100%);}
    }
    @media print{
      body{background:#fff;color:#000}
      .header,.tab-list,.toolbar,.pill{display:none !important}
      .card{box-shadow:none;border:1px solid #ddd}
      .out{background:#fff;color:#000;border:1px solid #ddd}
      a:link:after{content:" (" attr(href) ")"; font-size:0.9em}
      .tab-panel{display:block !important}
    }
    *{box-sizing:border-box} body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--text);background:var(--bg);line-height:1.6}
    h1,h2,h3{font-family:Poppins,Inter,sans-serif} a{color:var(--primary);text-decoration:none}
    .header{position:sticky;top:0;z-index:40;background:rgba(255,255,255,.9);backdrop-filter:saturate(1.2) blur(6px);border-bottom:1px solid var(--border)}
    @media (prefers-color-scheme: dark){ .header{background:rgba(16,23,38,.7);} }
    .nav{max-width:1200px;margin:0 auto;padding:14px 20px;display:flex;align-items:center;justify-content:space-between}
    .brand{display:flex;align-items:center;gap:10px;color:var(--primary);font-weight:800}
    .actions{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .wrap{max-width:1200px;margin:0 auto;padding:28px 20px}
    .hero{display:grid;grid-template-columns:1.2fr .8fr;gap:28px;align-items:center;background:linear-gradient(135deg,#ffffff 0%,#eef2ff 45%,#e0f2fe 100%);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:28px}
    .eyebrow{color:var(--primary-700);font-weight:800;letter-spacing:.02em}
    .lead{color:#374151;max-width:60ch}
    @media (prefers-color-scheme: dark){ .lead{color:#cbd5e1} }
    .pill{display:inline-flex;align-items:center;gap:8px;background:#fff;border:1px solid var(--border);border-radius:999px;padding:6px 10px;box-shadow:0 6px 14px rgba(0,0,0,.05)}
    .tabs{margin-top:26px}
    .tab-list{display:flex;gap:8px;flex-wrap:wrap}
    .tab-btn{border:1px solid var(--border);background:#fff;padding:10px 14px;border-radius:10px;font-weight:600;color:#374151;cursor:pointer}
    .tab-btn.active{background:var(--primary);border-color:var(--primary);color:#fff}
    .tab-panel{display:none;margin-top:18px}
    .tab-panel.active{display:block}
    .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:20px}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:18px}
    .col-12{grid-column:span 12} .col-6{grid-column:span 6} .col-4{grid-column:span 4}
    label{font-weight:600;color:#374151}
    @media (prefers-color-scheme: dark){ label{color:#cbd5e1} }
    input[type="text"], input[type="number"], input[type="email"], input[type="url"], textarea, select{width:100%;padding:12px 14px;border:2px solid var(--border);border-radius:10px;background:#fff}
    @media (prefers-color-scheme: dark){ input[type], textarea, select{background:#0f172a;color:#e5e7eb;border-color:#243044} }
    textarea{min-height:120px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:10px;border:1px solid var(--border);background:#fff;font-weight:600;cursor:pointer}
    .btn-primary{background:var(--primary);border-color:var(--primary);color:#fff}
    .btn-danger{background:#fee2e2;border-color:#fecaca;color:#991b1b}
    @media (prefers-color-scheme: dark){ .btn{background:#0f172a;border-color:#243044;color:#e5e7eb} .btn-primary{background:#1d4ed8;border-color:#1d4ed8} .btn-danger{background:#7f1d1d;border-color:#991b1b;color:#fff} }
    .toolbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .out{background:#ffffff;color:#111827;border-radius:12px;padding:12px;border:1px solid var(--border)}
    @media (prefers-color-scheme: dark){ .out{background:#0f172a;color:#e5e7eb} }
    .small{font-size:.9rem;color:#muted}
    table{width:100%;border-collapse:separate;border-spacing:0;border:1px solid var(--border);border-radius:12px;overflow:hidden}
    thead th{background:#f3f4f6;text-align:left;padding:10px 12px} tbody td{padding:10px 12px;border-top:1px solid var(--border)}
    @media (prefers-color-scheme: dark){ thead th{background:#111827} }
    .footer{margin:36px 0 12px;color:#9ca3af;text-align:center}
    :focus{outline:3px solid #22c55e; outline-offset: 2px;}
    @media (max-width:980px){.hero{grid-template-columns:1fr}.col-6{grid-column:span 12}.col-4{grid-column:span 12}.row{grid-template-columns:1fr}}
    .tour{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;z-index:1000}
    .tour .box{position:absolute;max-width:360px;background:var(--card);border:1px solid var(--border);border-radius:12px;box-shadow:var(--shadow);padding:14px}
  </style>
</head>
<body>
  <header class="header" role="banner">
    <nav class="nav" aria-label="Primary">
      <a class="brand" href="#"><span>üéØ MikeGuides</span></a>
      <div class="actions">
        <button id="saveBtn" class="btn btn-ghost" type="button">üíæ Save</button>
        <button id="importBtn" class="btn" type="button">üì• Import</button>
        <button id="exportJsonBtn" class="btn" type="button">üßæ Export JSON</button>
        <button id="bundleBtn" class="btn btn-primary" type="button">‚¨áÔ∏è Bundle Export (.zip)</button>
        <button id="shareLinkBtn" class="btn" type="button">üîó Copy Share Link</button>
        <button id="printBtn" class="btn" type="button">üñ®Ô∏è Print</button>
        <button id="resetBtn" class="btn btn-danger" type="button">‚ôªÔ∏è Reset All (Clear)</button>
        <span id="saveIndicator" class="small" aria-live="polite">Unsaved</span>
        <span id="jsReady" class="small" style="margin-left:8px;opacity:.8">JS: loading‚Ä¶</span>
      </div>
    </nav>
  </header>

  <main class="wrap" id="top" data-save-scope>
    <section class="hero" aria-label="Intro">
      <div>
        <div class="eyebrow">Step-by-Step AI for Small Business</div>
        <h1>AI Marketing Toolkit</h1>
        <p class="lead">Create <strong>ads, emails, social posts, landing pages</strong>, and <strong>image prompts</strong> in minutes.</p>
        <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:12px">
          <span class="pill">‚ö° Save time</span><span class="pill">üß† Works with ChatGPT/Claude</span><span class="pill">üß∞ Export-ready</span>
        </div>
      </div>
      <div class="card" aria-hidden="true">
        <h3 style="margin-top:0">What you'll build today</h3>
        <ul style="margin:8px 0 0 18px">
          <li>Platform-ready ad copy</li><li>Welcome or Promo email</li><li>7‚Äì30 day social calendar</li><li>Landing outline</li><li>Image prompts</li>
        </ul>
      </div>
    </section>

    <section class="tabs" aria-label="Toolkit modules">
      <div class="tab-list" role="tablist" data-tabs>
        <button class="tab-btn active" role="tab" aria-selected="true" aria-controls="tab-ads" type="button">Ads</button>
        <button class="tab-btn" role="tab" aria-controls="tab-emails" type="button">Emails</button>
        <button class="tab-btn" role="tab" aria-controls="tab-social" type="button">Social Calendar</button>
        <button class="tab-btn" role="tab" aria-controls="tab-landing" type="button">Landing Page</button>
        <button class="tab-btn" role="tab" aria-controls="tab-images" type="button">Image Prompts</button>
        <button class="tab-btn" role="tab" aria-controls="tab-checklist" type="button">Quick-Start</button>
      </div>

      <!-- ADS -->
      <div id="tab-ads" class="tab-panel active" role="tabpanel" tabindex="-1">
        <div class="card">
          <h2 style="margin-top:0">Ad Copy Generator</h2>
          <div class="grid">
            <div class="col-6"><label for="adPlatform">Platform</label><select id="adPlatform">
              <option>Google Search</option><option>Facebook / Instagram</option><option>LinkedIn</option><option>YouTube</option>
            </select></div>
            <div class="col-6"><label for="adTone">Tone/Voice</label><select id="adTone">
              <option>Helpful & straight-to-the-point</option><option>Confident & expert</option><option>Friendly & encouraging</option><option>Bold & urgent</option>
            </select></div>
            <div class="col-6"><label for="adAudience">Audience</label><input id="adAudience" type="text" placeholder="local service business owners" /></div>
            <div class="col-6"><label for="adOffer">Offer / Product</label><input id="adOffer" type="text" placeholder="AI Writing Workshop" /></div>
            <div class="col-12"><label for="adPain">Pain Points (comma-separated)</label><input id="adPain" type="text" placeholder="no time, inconsistent content, low engagement" /></div>
            <div class="col-12"><label for="adCTA">Desired Action (CTA URL or phrase)</label><input id="adCTA" type="url" placeholder="https://mikeguides.co/toolkit" data-cta /></div>
          </div>

          <!-- Presets -->
          <div class="toolbar" style="margin-top:12px">
            <label class="small" for="presetSelect">Presets:</label>
            <select id="presetSelect">
              <option value="">Choose‚Ä¶</option>
              <option value="local">Local Service</option>
              <option value="saas">SaaS</option>
              <option value="course">Course Creator</option>
              <option value="ecom">E-commerce</option>
            </select>
            <button id="applyPresetBtn" class="btn" type="button">Apply Preset</button>
          </div>

          <!-- UTM Builder -->
          <div class="toolbar" data-utm-builder>
            <span class="small">UTM:</span>
            <input type="url" placeholder="Base URL" data-utm-base style="max-width:260px">
            <input type="text" placeholder="source" data-utm-source style="max-width:120px">
            <input type="text" placeholder="medium" data-utm-medium style="max-width:120px">
            <input type="text" placeholder="campaign" data-utm-campaign style="max-width:140px">
            <button type="button" class="btn" data-utm-apply>Apply to CTA</button>
          </div>

          <div class="toolbar" style="margin-top:12px">
            <button class="btn btn-primary" id="genAdPrompt" type="button">Generate Prompt</button>
            <button class="btn" id="genAdDraft" type="button">Generate Draft Ad</button>
          </div>

          <div class="grid" style="margin-top:12px">
            <div class="col-6 output-block" data-filename="ad-prompt.md"><label>AI Prompt</label><textarea id="adPromptOut" class="out" spellcheck="false"></textarea></div>
            <div class="col-6 output-block" data-filename="ad-draft.md"><label>Draft Ad</label><textarea id="adDraftOut" class="out" spellcheck="false"></textarea></div>
          </div>

          <!-- Platform-specific counters -->
          <div class="card" style="margin-top:12px">
            <h3 style="margin-top:0">Platform Field Limits</h3>
            <div class="grid">
              <div class="col-6" data-group="google"><label for="googleHeadline1">Google Headline 1 (30)</label><input id="googleHeadline1" type="text" /></div>
              <div class="col-6" data-group="google"><label for="googleHeadline2">Google Headline 2 (30)</label><input id="googleHeadline2" type="text" /></div>
              <div class="col-12" data-group="google"><label for="googleDescription1">Google Description (90)</label><input id="googleDescription1" type="text" /></div>
              <div class="col-6" data-group="google"><label for="googlePath1">Google Path 1 (15)</label><input id="googlePath1" type="text" /></div>
              <div class="col-6" data-group="google"><label for="googlePath2">Google Path 2 (15)</label><input id="googlePath2" type="text" /></div>

              <div class="col-12"><hr style="border:none;border-top:1px solid var(--border);margin:8px 0"></div>

              <div class="col-12" data-group="facebook"><label for="fbPrimary">Facebook/IG Primary Text (125)</label><textarea id="fbPrimary" class="out" style="min-height:80px"></textarea></div>
              <div class="col-6" data-group="facebook"><label for="fbHeadline">Facebook Headline (40)</label><input id="fbHeadline" type="text" /></div>
              <div class="col-6" data-group="facebook"><label for="fbDescription">Facebook Description (30)</label><input id="fbDescription" type="text" /></div>

              <div class="col-12"><hr style="border:none;border-top:1px solid var(--border);margin:8px 0"></div>

              <div class="col-12" data-group="linkedin"><label for="liPrimary">LinkedIn Primary Text (300)</label><textarea id="liPrimary" class="out" style="min-height:80px"></textarea></div>
              <div class="col-6" data-group="linkedin"><label for="liHeadline">LinkedIn Headline (70)</label><input id="liHeadline" type="text" /></div>
            </div>
          </div>
        </div>
      </div>

      <!-- EMAILS -->
      <div id="tab-emails" class="tab-panel" role="tabpanel" tabindex="-1">
        <div class="card">
          <h2 style="margin-top:0">Email Builder</h2>
          <div class="grid">
            <div class="col-4"><label for="emailType">Campaign Type</label><select id="emailType"><option>Welcome</option><option>Promotion</option><option>Re-engagement</option><option>Newsletter</option></select></div>
            <div class="col-4"><label for="emailVoice">Voice/Tone</label><select id="emailVoice"><option>Friendly mentor</option><option>Direct & concise</option><option>Story-driven</option><option>Professional expert</option></select></div>
            <div class="col-4"><label for="emailOffer">Offer / Topic</label><input id="emailOffer" type="text" placeholder="AI Marketing Toolkit launch"/></div>
            <div class="col-12"><label for="emailAudience">Audience</label><input id="emailAudience" type="text" placeholder="small business owners"/></div>
          </div>
          <div class="toolbar" style="margin-top:12px">
            <button class="btn btn-primary" id="genEmail" type="button">Generate Email</button>
          </div>
          <div style="margin-top:12px" class="output-block" data-filename="email.md">
            <label>Subject + Body</label><textarea id="emailOut" class="out" spellcheck="false"></textarea>
          </div>
          <div class="grid" style="margin-top:12px">
            <div class="col-6"><label for="emailSubject">Subject (60)</label><input id="emailSubject" type="text"></div>
            <div class="col-6"><label for="emailPreheader">Preheader (90)</label><input id="emailPreheader" type="text"></div>
          </div>
        </div>
      </div>

      <!-- SOCIAL -->
      <div id="tab-social" class="tab-panel" role="tabpanel" tabindex="-1">
        <div class="card">
          <h2 style="margin-top:0">Social Caption Batch & Calendar</h2>
          <div class="grid">
            <div class="col-4"><label for="socialTopic">Primary Topic</label><input id="socialTopic" type="text" placeholder="using AI to write faster" /></div>
            <div class="col-4"><label for="socialVoice">Voice</label><select id="socialVoice"><option>Helpful</option><option>Bold</option><option>Inspirational</option><option>Humorous</option></select></div>
            <div class="col-4"><label for="socialDays">Days</label><select id="socialDays"><option value="7">7</option><option value="14">14</option><option value="30">30</option></select></div>
            <div class="col-12">
              <label>Content Mix</label>
              <div class="row">
                <label><input type="checkbox" class="mix" value="Educate" checked> Educate</label>
                <label><input type="checkbox" class="mix" value="Engage" checked> Engage</label>
                <label><input type="checkbox" class="mix" value="Promote" checked> Promote</label>
                <label><input type="checkbox" class="mix" value="Proof"> Proof</label>
              </div>
            </div>
          </div>
          <div class="toolbar" style="margin-top:12px">
            <button class="btn btn-primary" id="genSocial" type="button">Generate Calendar</button>
            <button class="btn" id="exportCsv" type="button">Export CSV</button>
          </div>
          <div style="margin-top:12px" class="card">
            <div style="overflow:auto">
              <table id="socialTable" aria-label="Social calendar">
                <thead><tr><th>Day</th><th>Theme</th><th>Caption</th></tr></thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- LANDING -->
      <div id="tab-landing" class="tab-panel" role="tabpanel" tabindex="-1">
        <div class="card">
          <h2 style="margin-top:0">Landing Page Copy Builder</h2>
          <div class="grid">
            <div class="col-6"><label for="lpAudience">Audience</label><input id="lpAudience" type="text" placeholder="solo service providers"/></div>
            <div class="col-6"><label for="lpOutcome">Desired Outcome</label><input id="lpOutcome" type="text" placeholder="publish content 3x faster"/></div>
            <div class="col-6"><label for="lpProduct">Product/Offer</label><input id="lpProduct" type="text" placeholder="AI Marketing Toolkit"/></div>
            <div class="col-6"><label for="lpMechanism">Unique Mechanism</label><input id="lpMechanism" type="text" placeholder="50+ prompts + calendar generator"/></div>
            <div class="col-12"><label for="lpPains">Top Pain Points (comma-separated)</label><input id="lpPains" type="text" placeholder="blank page, low engagement, inconsistency"/></div>
          </div>
          <div class="toolbar" style="margin-top:12px">
            <button class="btn btn-primary" id="genLanding" type="button">Generate Sections</button>
          </div>
          <div class="grid" style="margin-top:12px">
            <div class="col-12 output-block" data-filename="landing.md"><label>Sections (Markdown)</label><textarea id="lpOut" class="out" spellcheck="false"></textarea></div>
          </div>
          <div class="card" style="margin-top:12px">
            <h3 style="margin-top:0">Preview</h3>
            <div id="lpPreview" style="background:#fff;border:1px solid var(--border);border-radius:12px;padding:18px"></div>
          </div>
        </div>
      </div>

      <!-- IMAGES -->
      <div id="tab-images" class="tab-panel" role="tabpanel" tabindex="-1">
        <div class="card">
          <h2 style="margin-top:0">Image Prompt Library</h2>
          <div class="grid">
            <div class="col-4"><label for="imgSubject">Subject</label><input id="imgSubject" type="text" placeholder="laptop on desk, marketing icons"/></div>
            <div class="col-4"><label for="imgUse">Use-Case</label><select id="imgUse"><option>Ad Creative</option><option>Social Post</option><option>Website Hero</option><option>Icon Set</option></select></div>
            <div class="col-4"><label for="imgStyle">Style</label><select id="imgStyle"><option>Clean vector illustration</option><option>Flat 3D icon</option><option>Photorealistic product shot</option><option>Gradient mesh background</option><option>Isometric illustration</option></select></div>
            <div class="col-12"><label><input type="checkbox" id="brandColors" checked> Use brand colors (#2563eb and #22c55e)</label></div>
          </div>
          <div class="toolbar" style="margin-top:12px">
            <button class="btn btn-primary" id="genImgPrompts" type="button">Generate Prompts</button>
          </div>
          <div class="grid" style="margin-top:12px">
            <div class="col-6 output-block" data-filename="dalle-prompt.md"><label>DALL¬∑E Prompt</label><textarea id="imgDalle" class="out"></textarea></div>
            <div class="col-6 output-block" data-filename="midjourney-prompt.md"><label>Midjourney Prompt</label><textarea id="imgMidjourney" class="out"></textarea></div>
          </div>
        </div>
      </div>

      <!-- QUICK START -->
      <div id="tab-checklist" class="tab-panel" role="tabpanel" tabindex="-1">
        <div class="card">
          <h2 style="margin-top:0">Quick-Start Checklist</h2>
          <ol style="margin-left:18px">
            <li>Write one Google Search ad + one FB/IG ad.</li>
            <li>Generate a 7-day social calendar (export CSV).</li>
            <li>Draft a Welcome email.</li>
            <li>Build a Landing Page outline.</li>
            <li>Create 1‚Äì2 image prompts.</li>
          </ol>
        </div>
      </div>
    </section>

    <p class="footer">¬© 2025 MikeGuides</p>
  </main>

  <input id="importFile" type="file" accept="application/json" class="hidden" style="display:none" />

  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js" integrity="sha256-zfL1o9H3dP2aFhWm8X2t8uVd6lC0kptz4kTL7E+JkXc=" crossorigin="anonymous"></script>

  <script>
  // -------- Utils --------
  const $ = (sel, ctx=document) => ctx.querySelector(sel);
  const $$ = (sel, ctx=document) => Array.from(ctx.querySelectorAll(sel));
  const nowTime = () => new Date().toLocaleTimeString([], {hour:'numeric', minute:'2-digit'});
  const toast = (msg) => { console.log('[Toolkit]', msg); };

  function download(filename, text, type='text/plain') {
    const blob = new Blob([text], { type });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = filename; a.click(); URL.revokeObjectURL(url);
  }

  // -------- Tabs --------
  function initTabs() {
    document.querySelectorAll('.tabs').forEach(section => {
      const tabs = Array.from(section.querySelectorAll('[role="tab"]'));
      const panels = Array.from(section.querySelectorAll('.tab-panel'));
      if (!tabs.length || !panels.length) return;
      let activeIndex = tabs.findIndex(t => t.classList.contains('active') || t.getAttribute('aria-selected') === 'true');
      if (activeIndex < 0) activeIndex = 0;
      tabs.forEach((t,i)=>{ const on = i===activeIndex; t.classList.toggle('active', on); t.setAttribute('aria-selected', on ? 'true' : 'false'); t.tabIndex = on ? 0 : -1; });
      panels.forEach((p,i)=>{ const on = i===activeIndex; p.classList.toggle('active', on); if (on) p.removeAttribute('hidden'); else p.setAttribute('hidden',''); });
    });
    document.addEventListener('click', (e) => {
      const btn = e.target.closest('[role="tab"]'); if (!btn) return;
      const section = btn.closest('.tabs'); const tabs = Array.from(section.querySelectorAll('[role="tab"]'));
      const panels = Array.from(section.querySelectorAll('.tab-panel')); const idx = tabs.indexOf(btn);
      tabs.forEach((t,i)=>{ const on=i===idx; t.classList.toggle('active',on); t.setAttribute('aria-selected', on?'true':'false'); t.tabIndex = on?0:-1; });
      panels.forEach((p,i)=>{ const on=i===idx; p.classList.toggle('active',on); if(on){ p.removeAttribute('hidden'); p.focus(); } else { p.setAttribute('hidden',''); } });
    });
  }

  // -------- Generators --------
  function buildAdPrompt(data){
    return "You are a senior " + data.platform + " copywriter. Write high-converting ad copy in a " + data.tone + " voice for " + data.audience + ". Offer: " + data.offer + ". Address pains: " + data.pains + ". Include a clear call to action: " + data.cta + ". Provide 3 variations following platform limits.";
  }
  function buildAdDraft(data){
    var painsList = (data.pains||"").split(",").map(function(s){return s.trim();}).filter(Boolean);
    var bullets = painsList.slice(0,3).map(function(p){ return "‚Ä¢ " + p.charAt(0).toUpperCase()+p.slice(1); }).join("\n");
    var tag = data.platform.indexOf("Google")>=0? "[Search Ad]" : (data.platform.indexOf("Facebook")>=0||data.platform.indexOf("Instagram")>=0? "[Social Ad]" : (data.platform.indexOf("LinkedIn")>=0? "[LinkedIn Ad]" : "[Ad]"));
    return tag + "\nHeadline: " + data.offer + " for " + data.audience + "\nBody: Tired of " + (painsList[0]||"slow content") + "? " + data.offer + " helps you move faster with AI.\n" + bullets + "\nCTA: " + data.cta;
  }
  function buildEmail(){
    var type=$('#emailType').value; var voice=$('#emailVoice').value; var offer=$('#emailOffer').value||'AI Marketing Toolkit'; var audience=$('#emailAudience').value||'small business owners';
    var subt = {'Welcome': ['Welcome aboard ‚Äî let\'s get you results with AI', 'Great to have you, here\'s a quick win'],
                'Promotion': ['Last chance: ' + offer + ' at launch pricing', offer + ': save time, grow faster'],
                'Re-engagement': ['Still want faster marketing?', 'Quick win to restart your content'],
                'Newsletter': ['Weekly tips: get more from AI marketing', '3 ideas to try this week'] }[type][0];
    var body = "Hi there,\n\nI built " + offer + " for " + audience + " who want to market in less time. In a " + voice.toLowerCase() + " voice, here\'s what to do next:\n\n1) Open the Ads tab and create a Google & FB/IG ad.\n2) Generate a 7-day social calendar.\n3) Use the Landing Page builder to turn clicks into customers.\n\nReady to move? ‚Äî Get " + offer + " now.\n\n‚Äî Mike";
    return "Subject: " + subt + "\n\n" + body;
  }
  function captionFor(theme, topic, voice){
    var hooks={Educate:['Quick tip:','Try this:','What most miss:'],Engage:['Hot take:','Question:','Agree or disagree?'],Promote:['Heads up:','Limited time:','If you are busy:'],Proof:['Win:','From a customer:','Behind the scenes:']};
    var closes={Helpful:['Save this for later.','DM me \"Toolkit\" for the link.','Tap to learn more.'],Bold:['Ready to scale?','Stop guessing. Start shipping.','Own your market.'],Inspirational:['You have got this.','Build daily momentum.','Small steps ‚Üí big wins.'],Humorous:['Low effort, high impact','AI is your new marketing intern.','Let us outsmart the algorithm.']};
    var h = hooks[theme][Math.floor(Math.random()*hooks[theme].length)];
    var cList = closes[voice] || ['']; var c = cList[Math.floor(Math.random()*cList.length)] || '';
    return h + " " + topic + ". " + c;
  }
  function buildCalendar(days, topic, voice, themes){
    var rows=[]; for(var i=1;i<=days;i++){ var t=themes[(i-1)%themes.length]; rows.push([i,t,captionFor(t,topic,voice)]); } return rows;
  }
  function buildSections(){
    var a=$('#lpAudience').value||'small business owners';
    var o=$('#lpOutcome').value||'publish content 3x faster';
    var p=$('#lpProduct').value||'AI Marketing Toolkit';
    var m=$('#lpMechanism').value||'50+ prompts + calendar generator';
    var pains=($('#lpPains').value||'blank page, low engagement, inconsistency').split(',').map(function(s){return s.trim();}).filter(Boolean);
    var h1=[p + ': ' + o, 'Stop the ' + (pains[0]||'blank page') + ' ‚Äî ' + o, 'Your ' + p + ' to ' + o];
    var sub='Step-by-step system for ' + a + '. Powered by ' + m + '.';
    var benefits=['Create ads, emails, and posts in minutes','Never face the blank page again','Consistent voice across channels','Export to Markdown & CSV','Built for busy entrepreneurs'];
    var ctas=['Get ' + p + ' now','Start creating in minutes'];
    var faq=['Who is this for? ‚Üí ' + a + '.','How fast can I see results? ‚Üí Same day for ads/posts.','Do I need to be technical? ‚Üí No.','Refunds? ‚Üí 30-day guarantee.'];
    var md = '# ' + h1[0] + '\n\n**' + sub + '**\n\n## Benefits\n- ' + benefits.join('\n- ') + '\n\n## What\'s inside\n- 50+ ad/email/social prompts\n- 7‚Äì30 day calendar generator\n- Landing page builder\n- Image prompt library\n\n## Call to action\n- ' + ctas[0] + '\n\n## FAQ\n- ' + faq.join('\n- ');
    var preview = '<h1>' + h1[0] + '</h1><p><strong>' + sub + '</strong></p><h3>Benefits</h3><ul>' + benefits.map(function(b){return '<li>'+b+'</li>';}).join('') + '</ul><h3>CTA</h3><p>' + ctas[0] + '</p><h3>FAQ</h3><ul>' + faq.map(function(f){return '<li>'+f+'</li>';}).join('') + '</ul>';
    return {md:md, preview:preview};
  }
  function buildImagePrompts(){
    var subj=$('#imgSubject').value||'clean desk with laptop, marketing icons';
    var use=$('#imgUse').value; var style=$('#imgStyle').value; var brand=$('#brandColors').checked ? ' Use brand colors #2563eb and #22c55e.' : '';
    var dalle='Create a ' + style.toLowerCase() + ' for ' + use.toLowerCase() + ': ' + subj + '. Minimal, high contrast, centered composition.' + brand;
    var mj='/imagine prompt: ' + style + ', ' + subj + ', ' + use + '. Minimal, high contrast, clean background.' + brand + ' --ar 3:2 --v 6 --s 250 --style raw';
    return {dalle:dalle, mj:mj};
  }

  // -------- Output toolbars --------
  function enhanceOutputs(){
    $$('.output-block').forEach(function(block){
      if(block.dataset.enhanced) return; block.dataset.enhanced='1';
      var toolbar=document.createElement('div'); toolbar.className='toolbar'; toolbar.style.marginBottom='8px';
      var btnCopy=document.createElement('button'); btnCopy.className='btn'; btnCopy.type='button'; btnCopy.textContent='Copy';
      var btnMd=document.createElement('button'); btnMd.className='btn'; btnMd.type='button'; btnMd.textContent='Download .md';
      var btnTxt=document.createElement('button'); btnTxt.className='btn'; btnTxt.type='button'; btnTxt.textContent='Download .txt';
      toolbar.append(btnCopy,btnMd,btnTxt); block.prepend(toolbar);
      function getText(){ var ta=block.querySelector('textarea'); var pre=block.querySelector('pre,code'); return ta?ta.value:(pre?pre.innerText:block.innerText.trim()); }
      btnCopy.addEventListener('click',function(){ var t=getText(); if(navigator.clipboard&&navigator.clipboard.writeText){ navigator.clipboard.writeText(t).catch(function(){}); } else { alert('Copy:\n\n'+t.slice(0,400)); } });
      btnMd.addEventListener('click',function(){ var name=block.dataset.filename||'output.md'; download(name, getText(), 'text/markdown'); });
      btnTxt.addEventListener('click',function(){ var name=(block.dataset.filename||'output.md').replace(/\.md$/i,'.txt'); download(name, getText(), 'text/plain'); });
    });
  }

  // -------- Counters --------
  function attachCounter(el, max){
    if(!el || el.dataset.counterWired) return;
    el.dataset.counterWired='1';
    var meter=document.createElement('div'); meter.className='text-xs small'; meter.style.textAlign='right'; meter.style.marginTop='6px';
    el.insertAdjacentElement('afterend', meter);
    function paint(){
      var val = (el.value || el.innerText || '');
      var len = val.length;
      var rem = max - len;
      meter.textContent = len + '/' + max + (rem<0?(' (over by '+(-rem)+')'):'');
      meter.style.color = rem<0 ? 'crimson' : '';
      el.style.outline = rem<0 ? '2px solid crimson' : '';
    }
    ['input','keyup','change','blur'].forEach(function(evt){ el.addEventListener(evt, paint); });
    paint();
  }
  function wireCounters(){
    attachCounter($('#googleHeadline1'),30); attachCounter($('#googleHeadline2'),30);
    attachCounter($('#googleDescription1'),90); attachCounter($('#googlePath1'),15); attachCounter($('#googlePath2'),15);
    attachCounter($('#fbPrimary'),125); attachCounter($('#fbHeadline'),40); attachCounter($('#fbDescription'),30);
    attachCounter($('#liPrimary'),300); attachCounter($('#liHeadline'),70);
    attachCounter($('#emailSubject'),60); attachCounter($('#emailPreheader'),90);
  }

  // -------- Platform view toggle --------
  function updatePlatformFields(){
    var p = ($('#adPlatform').value || '').toLowerCase();
    var showGoogle = p.indexOf('google')>=0;
    var showFacebook = p.indexOf('facebook')>=0 || p.indexOf('instagram')>=0;
    var showLinkedIn = p.indexOf('linkedin')>=0;
    $$('[data-group="google"]').forEach(function(el){ el.style.display = showGoogle? '' : 'none'; });
    $$('[data-group="facebook"]').forEach(function(el){ el.style.display = showFacebook? '' : 'none'; });
    $$('[data-group="linkedin"]').forEach(function(el){ el.style.display = showLinkedIn? '' : 'none'; });
  }

  // -------- Presets --------
  function applyPreset(name){
    var presets = {
      local: { tone:'Helpful & straight-to-the-point', pains:'no time to write, need more calls, inconsistent content', cta:'Call now or book online', mix:['Educate','Engage','Promote'] },
      saas: { tone:'Confident & expert', pains:'manual workflows, tool sprawl, slow onboarding', cta:'Start free trial', mix:['Educate','Proof','Promote'] },
      course:{ tone:'Friendly & encouraging', pains:'overwhelmed by tech, not shipping content, low momentum', cta:'Enroll today', mix:['Educate','Engage','Promote'] },
      ecom: { tone:'Bold & urgent', pains:'cart abandonment, low CTR, ad fatigue', cta:'Shop the sale', mix:['Promote','Proof','Engage'] }
    };
    var p = presets[name]; if(!p) return;
    $('#adTone').value = p.tone; $('#adPain').value = p.pains; $('#adCTA').value = p.cta;
    $$('.mix').forEach(function(box){ box.checked = p.mix.indexOf(box.value)>=0; });
  }

  // -------- Autosave / Import / Export --------
  const STORAGE_KEYS = ['mikeguides_toolkit_v11','mikeguides_toolkit_v10','mikeguides_toolkit_v9'];
  function currentKey(){ return STORAGE_KEYS[0]; }
  function markSaved(){ var el=$('#saveIndicator'); if(el) el.textContent='Saved ‚Ä¢ ' + nowTime(); }
  function markDirty(){ var el=$('#saveIndicator'); if(el && !el.textContent.startsWith('Saved')) el.textContent='Unsaved'; }
  function collectState(){
    var scope = document.querySelector('[data-save-scope]') || document.body;
    var fields = $$('input, textarea, select, [contenteditable="true"]', scope).filter(function(el){ return !el.type || !['button','submit','file','reset','image'].includes(el.type); });
    var state = {};
    fields.forEach(function(el){
      var key = el.id || el.name; if(!key) return;
      state[key] = (el.type==='checkbox') ? el.checked : (el.type==='radio') ? (el.checked?el.value:(state[key]||null)) : (el.isContentEditable?el.innerText:el.value);
    });
    state['socialTableHTML'] = $('#socialTable') ? $('#socialTable').innerHTML : '';
    state['lpPreviewHTML'] = $('#lpPreview') ? $('#lpPreview').innerHTML : '';
    return state;
  }
  function applyState(state){
    if(!state) return;
    Object.keys(state).forEach(function(k){
      var v=state[k]; var el=document.getElementById(k); if(!el) return;
      if(el.type==='checkbox') el.checked=!!v;
      else if(el.type==='radio'){ var r = document.querySelector('[name="'+k+'"][value="'+v+'"]'); if(r) r.checked=true; }
      else if(el.isContentEditable) el.innerText = v || '';
      else el.value = v || '';
      el.dispatchEvent(new Event('input',{bubbles:true})); el.dispatchEvent(new Event('change',{bubbles:true}));
    });
    if(state.socialTableHTML && $('#socialTable')) $('#socialTable').innerHTML = state.socialTableHTML;
    if(state.lpPreviewHTML && $('#lpPreview')) $('#lpPreview').innerHTML = state.lpPreviewHTML;
  }
  function autosaveSetup(){
    var scope = document.querySelector('[data-save-scope]') || document.body; var debounce;
    $$('input, textarea, select, [contenteditable="true"]', scope).forEach(function(el){
      ['input','change','keyup','blur'].forEach(function(evt){
        el.addEventListener(evt, function(){ clearTimeout(debounce); debounce=setTimeout(function(){ localStorage.setItem(currentKey(), JSON.stringify(collectState())); markSaved(); }, 300); });
      });
    });
  }
  function restoreLocal(){
    var raw = null;
    for (var i=0;i<STORAGE_KEYS.length;i++){ raw = localStorage.getItem(STORAGE_KEYS[i]); if(raw) break; }
    if(!raw){ markDirty(); return; }
    try{ var state = JSON.parse(raw); applyState(state); markSaved(); } catch(e){ markDirty(); }
  }

  // -------- Shareable sessions via URL hash --------
  function copyShareLink(){
    try{
      var state = JSON.stringify(collectState());
      var enc = btoa(unescape(encodeURIComponent(state)));
      var base = (location.origin && location.origin !== 'null') ? (location.origin + location.pathname) : location.pathname;
      var url = base + '#s=' + enc;
      if(navigator.clipboard && navigator.clipboard.writeText){ navigator.clipboard.writeText(url); alert('Share link copied to clipboard'); }
      else { prompt('Copy this link:', url); }
    } catch (e){ alert('Could not create share link: ' + (e.message||String(e))); }
  }
  function loadFromHash(){
    if(!location.hash || location.hash.indexOf('#s=')!==0) return;
    try{
      var enc = location.hash.slice(3);
      var json = decodeURIComponent(escape(atob(enc)));
      var state = JSON.parse(json);
      applyState(state);
      localStorage.setItem(currentKey(), JSON.stringify(state));
      markSaved();
      alert('Session loaded from link');
    } catch(e){ console.warn('Hash load failed', e); }
  }

  // -------- UTM Builder --------
  function setupUTMBuilder(){
    var wrap = document.querySelector('[data-utm-builder]'); if(!wrap) return;
    var base=$('[data-utm-base]', wrap); var src=$('[data-utm-source]', wrap); var med=$('[data-utm-medium]', wrap); var camp=$('[data-utm-campaign]', wrap);
    var btn=$('[data-utm-apply]', wrap); var cta = document.querySelector('input[data-cta]') || base;
    btn.addEventListener('click', function(){
      try{
        var u = new URL((base.value||'').trim());
        if(src.value)  u.searchParams.set('utm_source', src.value.trim());
        if(med.value)  u.searchParams.set('utm_medium', med.value.trim());
        if(camp.value) u.searchParams.set('utm_campaign', camp.value.trim());
        var final = u.toString(); if(cta) cta.value = final; base.value = final;
      } catch { alert('Enter a valid Base URL (e.g., https://example.com/offer)'); }
    });
  }

  // -------- Bundle Export (.zip) --------
  function createBundle(){
    try{
      if (typeof JSZip === 'undefined') { alert('Bundle export needs JSZip (CDN). Check blockers/connectivity.'); return; }
      var zip = new JSZip();
      var md = [
        '# AI Marketing Toolkit',
        'Generated on: ' + new Date().toLocaleString(),
        '---',
        '## Ads', '### Prompt', $('#adPromptOut').value||'', '### Draft Ad', $('#adDraftOut').value||'',
        '## Email', $('#emailOut').value||'',
        '## Social Calendar', '(see CSV)',
        '## Landing', $('#lpOut').value||'',
        '## Image Prompts', '**DALL¬∑E**', $('#imgDalle').value||'', '**Midjourney**', $('#imgMidjourney').value||''
      ].join('\n\n');
      zip.file('outputs/ai-marketing-toolkit.md', md);
      zip.file('outputs/ad-prompt.md', $('#adPromptOut').value||'');
      zip.file('outputs/ad-draft.md', $('#adDraftOut').value||'');
      zip.file('outputs/email.md', $('#emailOut').value||'');
      zip.file('outputs/landing.md', $('#lpOut').value||'');
      zip.file('outputs/dalle-prompt.md', $('#imgDalle').value||'');
      zip.file('outputs/midjourney-prompt.md', $('#imgMidjourney').value||'');
      var rows=[["Day","Theme","Caption"]].concat(Array.from($('#socialTable tbody').rows).map(function(tr){return Array.from(tr.cells).map(function(td){return td.textContent;});}));
      var csv = rows.map(function(r){return r.map(function(v){return '"' + String(v).replace(/"/g,'""') + '"';}).join(',');}).join('\n');
      zip.file('outputs/social-calendar.csv', csv);
      zip.file('session.json', JSON.stringify(collectState(), null, 2));
      zip.generateAsync({type:'blob'}).then(function(blob){ var a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='ai-marketing-toolkit-export.zip'; a.click(); });
    } catch (err) { console.error(err); alert('Bundle export failed: ' + (err && err.message ? err.message : String(err))); }
  }

  // -------- Reset All --------
  function resetAll(){
    if(!confirm('Reset ALL fields and clear saved session?')) return;
    var scope = document.querySelector('[data-save-scope]') || document.body;
    $$('input, textarea, select, [contenteditable="true"]', scope).forEach(function(el){
      if(el.type === 'checkbox'){ el.checked = false; }
      else if(el.tagName === 'SELECT'){ el.selectedIndex = 0; }
      else if(el.type && ['button','submit','file','reset','image'].includes(el.type)){ /* ignore */ }
      else if(el.isContentEditable){ el.innerText=''; }
      else { el.value=''; }
    });
    var tbody=$('#socialTable tbody'); if(tbody) tbody.innerHTML='';
    var prev=$('#lpPreview'); if(prev) prev.innerHTML='';
    // defaults
    $('#brandColors').checked = true;
    $$('.mix').forEach(function(box){ box.checked = (box.value==='Educate'||box.value==='Engage'||box.value==='Promote'); });
    localStorage.removeItem('mikeguides_toolkit_v11');
    location.hash = '';
    markDirty();
    updatePlatformFields();
    alert('All fields reset.');
  }

  // -------- Tour --------
  function startTour(){
    if(localStorage.getItem('toolkit_toured')) return;
    var tour=document.createElement('div'); tour.className='tour'; tour.innerHTML='<div class="box" id="tourBox"><strong>Welcome!</strong><p>Use the tabs to switch modules. Click Generate to fill outputs. Use Save/Export to keep work.</p><div style="display:flex;gap:8px;justify-content:flex-end"><button type="button" class="btn" id="tourNext">Next</button><button type="button" class="btn" id="tourSkip">Skip</button></div></div>';
    document.body.appendChild(tour);
    var steps=[
      {anchor:'.tab-list', text:'1) Tabs switch modules. Keyboard: Left/Right.'},
      {anchor:'#genAdPrompt', text:'2) Click Generate buttons to create content.'},
      {anchor:'#saveBtn', text:'3) Use Save/Export to keep progress.'},
      {anchor:'#bundleBtn', text:'4) Bundle Export downloads everything at once.'}
    ];
    var i=0;
    function place(){
      var a=document.querySelector(steps[i].anchor); var box=$('#tourBox'); if(!a || !box){ tour.style.display='none'; return; }
      var r=a.getBoundingClientRect(); var x=r.left + window.scrollX; var y=r.bottom + window.scrollY + 8;
      box.style.left = (x) + 'px'; box.style.top = (y) + 'px'; box.querySelector('p').textContent = steps[i].text;
      tour.style.display='block';
    }
    $('#tourNext').onclick=function(){ i++; if(i>=steps.length){ tour.remove(); localStorage.setItem('toolkit_toured','1'); } else { place(); } };
    $('#tourSkip').onclick=function(){ tour.remove(); localStorage.setItem('toolkit_toured','1'); };
    place();
  }

  // -------- PWA --------
  function registerSW(){
    if(!('serviceWorker' in navigator)) return;
    try{ navigator.serviceWorker.register('sw.js'); } catch(e){ console.warn('SW register failed', e); }
  }

  // -------- Actions wiring --------
  function wireActions(){
    $('#genAdPrompt').addEventListener('click', function(){
      var data = { platform: $('#adPlatform').value, tone: $('#adTone').value, audience: $('#adAudience').value||'small business owners', offer: $('#adOffer').value||'AI Marketing Toolkit', pains: $('#adPain').value||'blank page, low engagement, inconsistency', cta: $('#adCTA').value||'Get the toolkit' };
      $('#adPromptOut').value = buildAdPrompt(data);
    });
    $('#genAdDraft').addEventListener('click', function(){
      var data = { platform: $('#adPlatform').value, tone: $('#adTone').value, audience: $('#adAudience').value||'small business owners', offer: $('#adOffer').value||'AI Marketing Toolkit', pains: $('#adPain').value||'blank page, low engagement, inconsistency', cta: $('#adCTA').value||'Get the toolkit' };
      $('#adDraftOut').value = buildAdDraft(data);
    });
    $('#genEmail').addEventListener('click', function(){ $('#emailOut').value = buildEmail(); });
    $('#genSocial').addEventListener('click', function(){
      var days=parseInt($('#socialDays').value,10); var topic=$('#socialTopic').value||'using AI to write faster'; var voice=$('#socialVoice').value; var themes=Array.from(document.querySelectorAll('.mix:checked')).map(function(x){return x.value;});
      if (!themes.length) themes = ['Educate','Engage','Promote'];
      var rows = buildCalendar(days, topic, voice, themes);
      var tbody=$('#socialTable tbody'); tbody.innerHTML='';
      rows.forEach(function(r){ var tr=document.createElement('tr'); r.forEach(function(cell){ var td=document.createElement('td'); td.textContent=cell; tr.appendChild(td); }); tbody.appendChild(tr); });
    });
    $('#exportCsv').addEventListener('click', function(){
      var rows=[["Day","Theme","Caption"]].concat(Array.from($('#socialTable tbody').rows).map(function(tr){return Array.from(tr.cells).map(function(td){return td.textContent;});}));
      var csv = rows.map(function(r){return r.map(function(v){return '"' + String(v).replace(/"/g,'""') + '"';}).join(',');}).join('\n');
      download('social-calendar.csv', csv, 'text/csv');
    });
    $('#genLanding').addEventListener('click', function(){ var s=buildSections(); $('#lpOut').value=s.md; $('#lpPreview').innerHTML=s.preview; });
    $('#genImgPrompts').addEventListener('click', function(){ var p=buildImagePrompts(); $('#imgDalle').value=p.dalle; $('#imgMidjourney').value=p.mj; });

    // Top toolbar
    $('#saveBtn').addEventListener('click', function(){ localStorage.setItem('mikeguides_toolkit_v11', JSON.stringify(collectState())); markSaved(); });
    $('#exportJsonBtn').addEventListener('click', function(){ try { var txt = JSON.stringify(collectState(), null, 2); download('session.json', txt, 'application/json'); } catch(e){ alert('Export failed: '+(e.message||String(e))); } });
    $('#importBtn').addEventListener('click', function(){ $('#importFile').click(); });
    $('#importFile').addEventListener('change', async function(e){ try{ var f=e.target.files && e.target.files[0]; if(!f) return; var text = await f.text(); var state = JSON.parse(text); applyState(state); localStorage.setItem('mikeguides_toolkit_v11', JSON.stringify(state)); markSaved(); alert('Import complete'); } catch(err){ alert('Import failed: ' + (err.message||String(err))); } finally { e.target.value=''; } });
    $('#bundleBtn').addEventListener('click', function(){ createBundle(); });
    $('#shareLinkBtn').addEventListener('click', function(){ copyShareLink(); });
    $('#printBtn').addEventListener('click', function(){ window.print(); });
    $('#resetBtn').addEventListener('click', function(){ resetAll(); });

    // Platform toggling & presets
    $('#adPlatform').addEventListener('change', updatePlatformFields);
    $('#applyPresetBtn').addEventListener('click', function(){ var v=$('#presetSelect').value; if(v) applyPreset(v); });
  }

  // -------- Init --------
  function init(){
    var badge=$('#jsReady'); if(badge){ badge.textContent='JS: ready'; badge.style.opacity='1'; }
    initTabs();
    enhanceOutputs();
    wireCounters();
    wireActions();
    autosaveSetup();
    restoreLocal();
    setupUTMBuilder();
    updatePlatformFields();
    loadFromHash();
    startTour();
    registerSW();
  }
  if(document.readyState==='loading'){ document.addEventListener('DOMContentLoaded', init); } else { init(); }
  </script>
</body>
</html>
